!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var i=n(1),o=r(i),s=n(2),u=r(s),a=n(3),c=r(a);angular.module("ngSimpleApi",[]).provider("SimpleApiEventEmitter",o.default).provider("SimpleApiModel",u.default).provider("SimpleApiRoot",c.default)},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(){"ngInject";this.$get=function(){return function(){function t(){n(this,t),this.$_listeners=[]}return i(t,[{key:"$on",value:function(t,e){return t in this.$_listeners||(this.$_listeners[t]=[]),this.$_listeners[t].push(e),this}},{key:"$once",value:function(t,e){var n=this,r=function r(){for(var i=arguments.length,o=Array(i),s=0;s<i;s++)o[s]=arguments[s];e.apply(null,o),n.$off(t,r)};this.$on(t,r)}},{key:"$off",value:function(t,e){var n=this.$_listeners[t]||[],r=n.indexOf(e);return-1!==r?(n.splice(r,1),this.$off(t,e)):this}},{key:"$emit",value:function(t,e){var n=this;return(this.$_listeners[t]||[]).map(function(t){t.call(n,e||{})}),this}}],[{key:"$make",value:function(e){return e.$_listeners||(e.$_listeners=[],e.$on=t.prototype.$on,e.$off=t.prototype.$off,e.$emit=t.prototype.$emit),e}}]),t}()}}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();e.default=r},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(){"ngInject";this.$get=["$http",function(t){return function(){function e(t,r,i,o,s){var u=this;n(this,e),this.name=t,this.actions={},this.endpoint=r,this.rootApi=i,this.currentAction=null,this.$io=o,this.$logger=s||i.$logger,this.ModelBuilded=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e[0],i=e[1];return 0==e.length?u:1==e.length?u[r]:void(u[r]=i)},this.$io&&this.rootApi.$on("user.setted",function(){u.$io.connect({userId:u.rootApi.currentUserId,id:u.rootApi.accessTokenId})}),this.rootApi.currentUserId&&this.rootApi.accessTokenId&&this.rootApi.$emit("user.setted",{})}return i(e,[{key:"buildUrl",value:function(t,n){return this.rootApi.getBaseUrl()+this.endpoint+e.buildUrl(t,n)}},{key:"httpBuildMethod",value:function(e){var n=this,r=this,i=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=e.isArray,u=s?[]:{};return i.method=e.method,i.url=r.buildUrl(e.url,n),i.headers=i.headers||{},r.rootApi.interceptor&&r.rootApi.interceptor(i),r.rootApi.accessTokenId&&(i.headers[r.rootApi.authHeader]||(i.headers[r.rootApi.authHeader]=r.rootApi.accessTokenId)),"GET"===i.method?i.params||(i.params=n):i.data||(i.data=n),u.$resolved=!1,u.$promise=t(i).then(function(t){return s?u.push.apply(u,t.data):angular.extend(u,t.data),u.$resolved=!0,(o||r.debug)&&r.$logger&&r.$logger(r.name+"."+e.name,n,u),u}).catch(function(t){throw u.$error=t.data,u.$resolved=!0,u.$error}),u};if(this.$io){var o=this.$io;if(!this.actions[actionName].socketable)return;var s=i,u=void 0;i=function(t){return u=s(t),u.$promise.then(function(){o.subscribe(u,"prototype.onUpdated",u.id)}),u}}return i.$url=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n.rootApi.url(n.buildUrl(e.url,t),!0)},i.$exec=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i(t,e,!0)},i}},{key:"httpMethod",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.currentAction=e,this.actions[e]=angular.extend({name:e,url:n},r,{method:t.toUpperCase()}),this.actions[e].fn=this.httpBuildMethod(this.actions[e]),this.ModelBuilded[e]=this.actions[e].fn,this}},{key:"socketable",value:function(t){if(this.currentAction=t=t||this.currentAction,!this.actions[t])throw new Error("not.defined.action."+t);return this.actions[t].socketable=!0,this}},{key:"isArray",value:function(t){if(this.currentAction=t=t||this.currentAction,!this.actions[t])throw new Error("not.defined.action."+t);return this.actions[t].isArray=!0,this}},{key:"method",value:function(t,e){return this.ModelBuilded.prototype[t]=e,this}},{key:"expand",value:function(t){return angular.extend(this.ModelBuilded,t),this}},{key:"get",value:function(t,e,n){return this.httpMethod("get",t,e,n)}},{key:"post",value:function(t,e,n){return this.httpMethod("post",t,e,n)}},{key:"delete",value:function(t,e,n){return this.httpMethod("delete",t,e,n)}},{key:"put",value:function(t,e,n){return this.httpMethod("put",t,e,n)}},{key:"patch",value:function(t,e,n){return this.httpMethod("patch",t,e,n)}},{key:"options",value:function(t,e,n){return this.httpMethod("options",t,e,n)}}],[{key:"buildUrl",value:function(t,e){return Object.keys(e).map(function(n){t=t.split(":"+n).join(e[n])}),t}}]),e}()}]}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();e.default=r},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(){"ngInject";var t={},e=["accessTokenId","currentUserId","rememberMe","currentUserData"];this.setBaseUrl=function(e,n){t[e]=n},this.$get=["SimpleApiEventEmitter","SimpleApiModel",function(o,u){return function(o){function a(t,i,o){n(this,a);var s=r(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return s.authHeader=i||"authorization",s.propsPrefix=t,s.models=function(){return s},s.instances={},s.$logger=o,e.forEach(function(t){s[t]=s._load(s.propsPrefix+t)}),s}return i(a,o),s(a,[{key:"getBaseUrl",value:function(){return t[this.propsPrefix]}},{key:"save",value:function(){var t=this,n=this.rememberMe?localStorage:sessionStorage;e.forEach(function(e){t._save(n,t.propsPrefix+e,t[e])})}},{key:"setUser",value:function(t,e,n){this.accessTokenId=t,this.currentUserId=e,this.currentUserData=n,this.$emit("user.setted",{})}},{key:"clearUser",value:function(){this.accessTokenId=null,this.currentUserId=null,this.currentUserData=null}},{key:"clearStorage",value:function(){var t=this;e.forEach(function(e){t._save(sessionStorage,t.propsPrefix+e,null),t._save(localStorage,t.propsPrefix+e,null)})}},{key:"url",value:function(t,e){if(!this.accessTokenId)return t;t=t.split("?");var n=[];return 1!==t.length&&n.push(t.pop()),n.push("access_token="+this.accessTokenId),t.push("?"+n.join("&")),e||t.unshift(this.getBaseUrl()),t=t.join("")}},{key:"_save",value:function(t,e,n){try{t[e]=JSON.stringify(n)}catch(t){console.log("Cannot access local/session storage:",t)}}},{key:"_load",value:function(t){return JSON.parse(localStorage[t]||sessionStorage[t]||"null")}},{key:"model",value:function(t,e){return this.instances[t]?this.instances[t]:(this.instances[t]=new u(t,e||"/"+t+"s",this),this.models[t]=this.instances[t].ModelBuilded,this.models[t])}}]),a}(o)}]}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();e.default=o}]);