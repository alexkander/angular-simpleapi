!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=n(1),i=r(o),s=n(2),u=r(s),a=n(3),c=r(a);angular.module("ngSimpleApi",[]).provider("SimpleApiEventEmitter",i.default).provider("SimpleApiModel",u.default).provider("SimpleApiRoot",c.default)},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(){"ngInject";this.$get=function(){return function(){function e(){n(this,e),this.$_listeners=[]}return o(e,[{key:"$on",value:function(e,t){return e in this.$_listeners||(this.$_listeners[e]=[]),this.$_listeners[e].push(t),this}},{key:"$once",value:function(e,t){var n=this,r=function r(){for(var o=arguments.length,i=Array(o),s=0;s<o;s++)i[s]=arguments[s];t.apply(null,i),n.$off(e,r)};this.$on(e,r)}},{key:"$off",value:function(e,t){var n=this.$_listeners[e]||[],r=n.indexOf(t);return-1!==r?(n.splice(r,1),this.$off(e,t)):this}},{key:"$emit",value:function(e,t){var n=this;return(this.$_listeners[e]||[]).map(function(e){e.call(n,t||{})}),this}}],[{key:"$make",value:function(t){return t.$_listeners||(t.$_listeners=[],t.$on=e.prototype.$on,t.$off=e.prototype.$off,t.$emit=e.prototype.$emit),t}}]),e}()}}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.default=r},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(){"ngInject";this.$get=["$http","$q",function(e,t){return function(){function r(e,t,o,i,s){var u=this;n(this,r),this.name=e,this.actions={},this.endpoint=t,this.rootApi=o,this.currentAction=null,this.$io=i,this.$logger=s||o.$logger,this.ModelBuilded=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],o=t[1];return 0==t.length?u:1==t.length?u[r]:void(u[r]=o)},this.$io&&this.rootApi.$on("user.setted",function(){u.$io.connect({userId:u.rootApi.currentUserId,id:u.rootApi.accessTokenId})}),this.rootApi.currentUserId&&this.rootApi.accessTokenId&&this.rootApi.$emit("user.setted",{})}return o(r,[{key:"buildUrl",value:function(e,t){return this.rootApi.getBaseUrl()+this.endpoint+r.buildUrl(e,t)}},{key:"httpBuildMethod",value:function(n){var r=this,o=this,i=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=n.isArray,a=u?[]:{},c=t.resolve(),l=function(e){return e.method=n.method,e.url=o.buildUrl(n.url,r),e.headers=e.headers||{},o.rootApi.interceptor&&(c=t.resolve().then(function(){return o.rootApi.interceptor(e)})),o.rootApi.accessTokenId&&(e.headers[o.rootApi.authHeader]||(e.headers[o.rootApi.authHeader]=o.rootApi.accessTokenId)),"GET"===e.method?e.params||(e.params=r):e.data||(e.data=r),e};return a.$resolved=!1,a.$promise=t.resolve(c).then(function(){var t=function(){return e(l(Object.assign({},i)))};return o.rootApi.postProcessed?o.rootApi.postProcessed(t(),t):t()}).then(function(e){return u?a.push.apply(a,e.data):angular.extend(a,e.data),a.$resolved=!0,(s||o.debug)&&o.$logger&&o.$logger(o.name+"."+n.name,r,a),a}).catch(function(e){throw a.$error=e.data,a.$resolved=!0,a.$error}),a};if(this.$io){var s=this.$io;if(!this.actions[actionName].socketable)return;var u=i,a=void 0;i=function(e){return a=u(e),a.$promise.then(function(){s.subscribe(a,"prototype.onUpdated",a.id)}),a}}return i.$url=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r.rootApi.url(r.buildUrl(n.url,e),!0)},i.$exec=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i(e,t,!0)},i}},{key:"httpMethod",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.currentAction=t,this.actions[t]=angular.extend({name:t,url:n},r,{method:e.toUpperCase()}),this.actions[t].fn=this.httpBuildMethod(this.actions[t]),this.ModelBuilded[t]=this.actions[t].fn,this}},{key:"socketable",value:function(e){if(this.currentAction=e=e||this.currentAction,!this.actions[e])throw new Error("not.defined.action."+e);return this.actions[e].socketable=!0,this}},{key:"isArray",value:function(e){if(this.currentAction=e=e||this.currentAction,!this.actions[e])throw new Error("not.defined.action."+e);return this.actions[e].isArray=!0,this}},{key:"method",value:function(e,t){return this.ModelBuilded.prototype[e]=t,this}},{key:"expand",value:function(e){return angular.extend(this.ModelBuilded,e),this}},{key:"get",value:function(e,t,n){return this.httpMethod("get",e,t,n)}},{key:"post",value:function(e,t,n){return this.httpMethod("post",e,t,n)}},{key:"delete",value:function(e,t,n){return this.httpMethod("delete",e,t,n)}},{key:"put",value:function(e,t,n){return this.httpMethod("put",e,t,n)}},{key:"patch",value:function(e,t,n){return this.httpMethod("patch",e,t,n)}},{key:"options",value:function(e,t,n){return this.httpMethod("options",e,t,n)}}],[{key:"buildUrl",value:function(e,t){return Object.keys(t).map(function(n){e=e.split(":"+n).join(t[n])}),e}}]),r}()}]}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.default=r},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(){"ngInject";var e={},t=["accessTokenId","currentUserId","rememberMe","currentUserData"];this.setBaseUrl=function(t,n){e[t]=n},this.$get=["SimpleApiEventEmitter","SimpleApiModel",function(i,u){return function(i){function a(e,o,i){n(this,a);var s=r(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return s.authHeader=o||"authorization",s.propsPrefix=e,s.models=function(){return s},s.instances={},s.$logger=i,t.forEach(function(e){s[e]=s._load(s.propsPrefix+e)}),s}return o(a,i),s(a,[{key:"getBaseUrl",value:function(){return e[this.propsPrefix]}},{key:"save",value:function(){var e=this,n=this.rememberMe?localStorage:sessionStorage;t.forEach(function(t){e._save(n,e.propsPrefix+t,e[t])})}},{key:"setUser",value:function(e,t,n){this.accessTokenId=e,this.currentUserId=t,this.currentUserData=n,this.$emit("user.setted",{})}},{key:"clearUser",value:function(){this.accessTokenId=null,this.currentUserId=null,this.currentUserData=null}},{key:"clearStorage",value:function(){var e=this;t.forEach(function(t){e._save(sessionStorage,e.propsPrefix+t,null),e._save(localStorage,e.propsPrefix+t,null)})}},{key:"url",value:function(e,t){if(!this.accessTokenId)return e;e=e.split("?");var n=[];return 1!==e.length&&n.push(e.pop()),n.push("access_token="+this.accessTokenId),e.push("?"+n.join("&")),t||e.unshift(this.getBaseUrl()),e=e.join("")}},{key:"_save",value:function(e,t,n){try{e[t]=JSON.stringify(n)}catch(e){console.log("Cannot access local/session storage:",e)}}},{key:"_load",value:function(e){return JSON.parse(localStorage[e]||sessionStorage[e]||"null")}},{key:"model",value:function(e,t){return this.instances[e]?this.instances[e]:(this.instances[e]=new u(e,t||"/"+e+"s",this),this.models[e]=this.instances[e].ModelBuilded,this.models[e])}}]),a}(i)}]}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.default=i}]);